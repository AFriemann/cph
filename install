#!/bin/sh

CC=gcc
CFLAGS="-g -O2 -Wall -lm -o"
LDFLAGS=

PKGCFG=

MAINFOLDER="src/core"
TESTFOLDER="src/test"

MAINSOURCE="$MAINFOLDER/cph.c"
SUPPSOURCES="$MAINFOLDER/cph_key.c $MAINFOLDER/cph_input_handler.c $MAINFOLDER/cph_clipboard_handler.c"

MAINBIN="cph"
TESTBIN="test"

BIN=
SOURCES=

compile () {
  ($CC $CFLAGS $BIN $SOURCES $PKGCFG)
  return $?
}

setMainSources () {
  BIN=$MAINBIN
  SOURCES="$MAINSOURCE $SUPPSOURCES"
  PKGCFG="`pkg-config --cflags --libs gtk+-3.0` `libgcrypt-config --cflags --libs`"
}

setTestSources () {
  BIN=$TESTBIN
  SOURCES="$TESTFOLDER/cphTests.c $TESTFOLDER/cphKeyTests.c $SUPPSOURCES"
  PKGCFG="`pkg-config --cflags --libs cunit gtk+-3.0` `libgcrypt-config --cflags`"
}

case "$1" in
  test )
    setTestSources
    ;;
  clean )
    rm -f $MAINBIN $TESTBIN
    exit 0
    ;;
  * )
    setMainSources
    ;;
esac

compile
exit $?
